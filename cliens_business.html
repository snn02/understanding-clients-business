<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Анализ бизнеса клиента</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f7fa;
            color: #333;
        }

        .header {
            background-color: #ffffff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
        }

        .header>div {
            display: flex;
            flex-direction: column;
            flex: 1;
            min-width: 250px;
        }

        label {
            font-weight: 600;
            margin-bottom: 5px;
            color: #444;
        }

        input,
        textarea {
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 14px;
            box-sizing: border-box;
        }

        #apiKey {
            font-family: monospace;
        }

        button {
            padding: 10px 20px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.2s;
            align-self: flex-end;
            height: fit-content;
        }

        button:hover {
            background-color: #0056b3;
        }

        button:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
        }

        .status {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
            display: none;
        }

        .status.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background-color: #ffffff;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            table-layout: fixed;
            margin-bottom: 30px;
        }

        th,
        td {
            border: 1px solid #e1e4e8;
            padding: 12px;
            vertical-align: top;
            word-wrap: break-word;
            text-align: left;
        }

        th {
            background-color: #f1f3f5;
            font-weight: 600;
            color: #495057;
        }

        .code-col {
            width: 6%;
        }

        .question-col {
            width: 20%;
        }

        .comment-col {
            width: 24%;
        }

        .explanation-col {
            width: 24%;
        }

        .answer-col {
            width: 24%;
        }

        .section-header {
            font-weight: bold;
            background-color: #fff3cd;
            /* Светло-оранжевый */
            color: #856404;
        }

        .section-header .answer-col {
            background-color: #fff3cd;
            /* Светло-оранжевый для колонки Ответ в строках-заголовках */
        }

        textarea {
            width: 100%;
            height: 80px;
            box-sizing: border-box;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-family: inherit;
            font-size: 13px;
            padding: 8px;
            resize: vertical;
        }

        textarea:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, .25);
        }

        .hidden {
            display: none;
        }

        .instructions {
            background-color: #e9ecef;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 14px;
        }

        .instructions h3 {
            margin-top: 0;
        }

        .instructions ul {
            margin: 10px 0;
            padding-left: 20px;
        }

        .instructions li {
            margin-bottom: 5px;
        }

        .debug-section {
            margin-top: 30px;
            padding: 15px;
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
        }

        .debug-section h3 {
            margin-top: 0;
            color: #495057;
        }

        #rawResponse {
            width: 100%;
            min-height: 150px;
            font-family: monospace;
            white-space: pre-wrap;
            background-color: #ffffff;
            border: 1px solid #ced4da;
            border-radius: 4px;
            padding: 10px;
            box-sizing: border-box;
        }
    </style>
</head>

<body>
    <div class="instructions">
        <h3>Инструкция:</h3>
        <ul>
            <li>Введите ваш API-ключ от ProxyAPI.</li>
            <li>Введите название компании для анализа.</li>
            <li>Нажмите "Заполнить" для автоматического получения ответов от ИИ.</li>
            <li>Отредактируйте ответы при необходимости.</li>
            <li>Нажмите "Сохранить ответы" для экспорта таблицы в CSV.</li>
        </ul>
    </div>

    <div class="header">
        <div>
            <label for="apiKey">API-ключ ProxyAPI:</label>
            <input type="password" id="apiKey" placeholder="Введите ваш API-ключ">
        </div>
        <div>
            <label for="companyName">Название компании:</label>
            <input type="text" id="companyName" placeholder="Введите название компании">
        </div>
        <button id="fillBtn">Заполнить</button>
        <button id="saveBtn">Сохранить ответы</button>
        <div id="statusMessage" class="status"></div>
    </div>

    <table id="questionsTable">
        <colgroup>
            <col class="code-col">
            <col class="question-col">
            <col class="comment-col">
            <col class="explanation-col">
            <col class="answer-col">
        </colgroup>
        <thead>
            <tr>
                <th>Код</th>
                <th>Вопрос</th>
                <th>Комментарий к вопросу</th>
                <th>Пояснение к вопросу</th>
                <th>Ответ</th>
            </tr>
        </thead>
        <tbody>
            <!-- Данные будут заполнены скриптом -->
        </tbody>
    </table>

    <div class="debug-section">
        <h3>Отладка: Сырой ответ от ИИ</h3>
        <textarea id="rawResponse" readonly
            placeholder="Здесь будет отображаться необработанный ответ от ИИ после нажатия кнопки 'Заполнить'..."></textarea>
    </div>

    <div class="debug-section" style="margin-top: 20px;">
        <h3>Отладка: Промт, отправленный в ИИ</h3>
        <textarea id="sentPrompt" readonly
            placeholder="Здесь будет отображаться промт, отправленный в ИИ..."></textarea>
    </div>

    <script>
        // Данные вопросов (первые 10 для отладки)
        const questionsData = [
            {
                "Код": "10.00",
                "Вопрос": "Информация о Заказчике по модели 4P product, price, place, promotion product, price, place, promotion",
                "Комментарий к вопросу": "",
                "Пояснение к вопросу": "",
                "Принято": "",
                "Ответ РП": "",
                "Пример заполнения(Abrau-Durso)": ""
            },
            {
                "Код": "10.01",
                "Вопрос": "Основные продукты/ услуги(product)",
                "Комментарий к вопросу": "Продукт — это то, что компания предлагает своим клиентам. Это может быть физический товар, услуга или цифровой продукт. Важно учитывать качество, дизайн, особенности и упаковку продукта, так как они играют ключевую роль в восприятии продукта клиентами.<br>Например, смартфон с уникальными функциями и стильным дизайном может привлечь внимание потребителей и выделиться на фоне конкурентов. Важно также учитывать жизненный цикл продукта и своевременно обновлять его, чтобы оставаться конкурентоспособными.",
                "Пояснение к вопросу": "Перечислить основные товары/услуги клиента.<br>Укажите 3–5 ключевых товаров/услуг: название/тип, характеристика(объём/сегмент), целевая аудитория, роль в бизнесе(основной доход/нишевый/имиджевый).<br>Пример:<br> - Игристые вина, 0.75 л.<br>- Экскурсии с дегустацией",
                "Принято": "Да",
                "Ответ РП": "",
                "Пример заполнения(Abrau-Durso)": "Игристые вина(массовые и премиальные), столовые вина, сидр, безалкогольные напитки, винный туризм.<br>Компания известна прежде всего игристыми винами, но в портфеле также есть тихие вина, сидры и безалкогольные продукты. Кроме того, они активно развивают винный туризм(экскурсии, бутики, мероприятия)."
            },
            {
                "Код": "10.02",
                "Вопрос": "Подход к ценообразованию(price)",
                "Комментарий к вопросу": "\"От каких факторов зависят цены клиента(например, биржевые цены, тендеры заказчиков, сравнение цен с конкурентами, устанавливают от полной себестоимости с учетом плановой рентабельности).<br>Являетли ли спрос эластичным?(Если от изменения цены спрос сильно растет или падает, его называют эластичным.)\"",
                "Пояснение к вопросу": "Как клиент устанавливает цены: ориентируется на рынок, конкурентов, себестоимость или тендеры? Влияет ли цена на спрос сильно или слабо?<br>Пример:<br> - Цены устанавливаются по себестоимости+ маржа 20%.<br>- В тендерах цена зависит от условий заказчика.",
                "Принято": "Да",
                "Ответ РП": "",
                "Пример заполнения(Abrau-Durso)": "Abrau-Durso использует сегментированный подход: массовые линейки стоят в среднем ценовом диапазоне, а премиальные коллекции — выше среднего. Цены ориентированы как на конкурентов, так и на себестоимость.<br>У компании есть и доступные вина для супермаркетов, и коллекции премиум-уровня. В массовом сегменте цена должна оставаться конкурентной, иначе продукт не купят. В премиуме цена выше, так как там акцент на имидж и качество.<br>Таким образом, политика разная для разных линеек, что типично для больших производителей."
            },
            {
                "Код": "10.03",
                "Вопрос": "Место продажи, каналы распространения(place)",
                "Комментарий к вопросу": "Место — это каналы распространения продукта. Например, федеральные сети, региональные сети, розничые магазины (несетевые), юридические лица(не розница), дистрибуторы, сайт, маркетплейсы.",
                "Пояснение к вопросу": "Где и как клиент продаёт свои товары/услуги: через магазины, дистрибьюторов, сайт, маркетплейсы, офисы продаж?<br>Пример:<br> - Продажи через собственный интернет-магазин и Wildberries.<br>- Оптовая дистрибуция в федеральные сети.",
                "Принято": "Да",
                "Ответ РП": "",
                "Пример заполнения(Abrau-Durso)": "Розничные сети, независимые магазины, собственные бутики, онлайн-каналы, экспорт.<br>Продукция Abrau-Durso широко представлена в федеральных сетях, имеет собственные точки продаж, активно развивает e-commerce и поставляет на экспорт."
            },
            {
                "Код": "10.04",
                "Вопрос": "Продвижение(promotion)",
                "Комментарий к вопросу": "Продвижение — это методы, которые используются для информирования и привлечения клиентов. Это может быть реклама, PR, социальные сети, email-маркетинг и другие инструменты. Пример: рекламная кампания в социальных сетях для продвижения нового смартфона может привлечь внимание целевой аудитории и стимулировать интерес к продукту. Важно также учитывать интегрированные маркетинговые коммуникации и координировать усилия по продвижению через различные каналы для достижения максимального эффекта.",
                "Пояснение к вопросу": "Какие инструменты клиент использует для привлечения покупателей: реклама, соцсети, PR, участие в выставках, скидки?<br>Пример:<br> - Таргетированная реклама в VK.<br>-  Участие в выставке «Продэкспо».",
                "Принято": "Да",
                "Ответ РП": "",
                "Пример заполнения(Abrau-Durso)": "Abrau-Durso продвигает бренд через PR, участие в конкурсах и выставках, рекламу в медиа и соцсетях, а также с помощью винного туризма и мероприятий.<br>У компании несколько каналов продвижения: они активно используют участие в международных конкурсах(это повышает доверие к качеству), приглашают клиентов в туристический комплекс (экскурсии и дегустации работают как маркетинг), а также делают ставку на присутствие в digital. Это помогает формировать имидж бренда и увеличивать узнаваемость."
            },
            {
                "Код": "20.00",
                "Вопрос": "Конкурентоспособность",
                "Комментарий к вопросу": "",
                "Пояснение к вопросу": "",
                "Принято": "",
                "Ответ РП": "",
                "Пример заполнения(Abrau-Durso)": ""
            },
            {
                "Код": "20.01",
                "Вопрос": "Кто основные конкуренты",
                "Комментарий к вопросу": "ТОП-5 основных конкурентов. Чем конкуренты превосходят Заказчика? В чем Заказчик превосходит конкурентов?",
                "Пояснение к вопросу": "Назовите 3–5 главных конкурентов клиента. В чём они сильнее, а в чём слабее?<br>Пример:<br> - Конкурент А: сильнее в маркетинге, слабее в сервисе.<br>- Конкурент B: ниже цены, но хуже качество.",
                "Принято": "Да",
                "Ответ РП": "",
                "Пример заполнения(Abrau-Durso)": "Fanagoria, Шато Тамань, Новый свет, Золотая балка, Массандра и другие крупные винные дома.<br>Это крупные российские производители вина, которые работают в том же ценовом сегменте и регионах."
            },
            {
                "Код": "20.02",
                "Вопрос": "Узнаваемость бренда и торговой марки",
                "Комментарий к вопросу": "Узнаваемость бренда и торговой марки",
                "Пояснение к вопросу": "Насколько известен бренд клиента на рынке и среди целевой аудитории?<br>Пример:<br> - Бренд известен только в регионе.<br>- Высокая узнаваемость по всей стране.",
                "Принято": "Да",
                "Ответ РП": "",
                "Пример заполнения(Abrau-Durso)": "Высокая узнаваемость по всей стране, особенно в сегменте игристых вин.<br>Abrau-Durso — один из старейших винных брендов в стране, его активно продвигают в СМИ, он есть в каждой крупной торговой сети и традиционно ассоциируется с Новым годом и праздничным столом. Благодаря этому уровень узнаваемости значительно выше, чем у большинства локальных виноделен."
            },
            {
                "Код": "20.03",
                "Вопрос": "Уникальность торгового предложения",
                "Комментарий к вопросу": "Что Заказчик использует для отличия от конкурентов в сознании клиента? Какую ценность Заказчик создает для клиентов, которую не создают или в недостаточной степени создают для клиентов?",
                "Пояснение к вопросу": "Чем клиент выделяется на фоне конкурентов, какую особую ценность даёт своим покупателям?<br>Пример:<br> - Собственные виноградники+ традиционный метод шампанизаци.<br>- Доставка в день заказа.",
                "Принято": "Да",
                "Ответ РП": "",
                "Пример заполнения(Abrau-Durso)": "Комбинация исторического бренда, российского происхождения, международных наград и развитого туристического комплекса.<br>Эти факторы выделяют компанию на фоне конкурентов, которые чаще ориентируются только на производство и сбыт."
            },
            {
                "Код": "20.04",
                "Вопрос": "Качество продуктов/ товаров/ сервисов/ услуг",
                "Комментарий к вопросу": "Оценка качества продуктов/ товаров/ сервисов/ услуг на фоне конкурентов.",
                "Пояснение к вопросу": "Как качество продуктов/ сервисов/ услуг Заказчиков отличается от конкурентов?<br>Например, Заказчик оказывает профессиональные услуги.<br>Заказчик тратит силы и деньги на развитие компетенций и сертификацию сотрудников. Большая часть конкурентов по мнению Заказичка предпринимает существенно меньшие усилия на развитие персонала. Это приводит к тому, что услуги в целом более высокого качества, чем у многих<br>конкурентов...<br>Как клиенты оценивают качество по сравнению с конкурентами?<br>Пример:<br> - Высокое качество, подтверждено сертификатами ISO.<br>- Сервис выше среднего, но сроки доставки часто срываются.",
                "Принято": "Да",
                "Ответ РП": "",
                "Пример заполнения(Abrau-Durso)": "Качество продукции Abrau-Durso оценивается как выше среднего на российском рынке: вина регулярно получают международные награды, премиальные линейки соответствуют высоким стандартам.<br>У компании есть подтверждение качества через международные конкурсы(Decanter, IWSC и др.). Это показывает, что продукт не только востребован в массовом сегменте, но и соответствует мировым стандартам. Также премиальные линейки позиционируются как «российский аналог европейских вин», что повышает восприятие качества у покупателей."
            },
            {
                "Код": "20.05",
                "Вопрос": "Повторные продажи",
                "Комментарий к вопросу": "Готовы ли клиенты Заказчика приобретать продукты повторно?(при наличии потребности).",
                "Пояснение к вопросу": "Частота и доля повторных клиентов.<br>Покупают ли клиенты повторно? Есть ли постоянные заказчики?<br>Пример:<br> - 60% заказов — от постоянных клиентов.<br>– Массовый сегмент — высокий% повторных продаж, премиум — реже.",
                "Принято": "Да",
                "Ответ РП": "",
                "Пример заполнения(Abrau-Durso)": "Массовые линейки покупают регулярно(сезонные всплески), премиум — лояльные клиенты и корпоративные заказы.<br>Игристые вина традиционно покупают к праздникам, поэтому массовый сегмент стабилен. Премиальные линейки формируют устойчивую базу клиентов."
            },
            {
                "Код": "20.06",
                "Вопрос": "Профессионализм сотрудников",
                "Комментарий к вопросу": "Оценка компетенций сотрудников в сравнении с конкурентами. Например,\"мы принимаем наиболее талантливых сотрудников и платим много\",\"большая часть сотрудников имеет средний уровень, есть эксперты\", \"большая часть сотрудников имеет низкую квалификацию\"",
                "Пояснение к вопросу": "Какой уровень компетенций и квалификации сотрудников у клиента по сравнению с конкурентами? Важно понять: есть ли у компании сильные эксперты, обучают ли персонал, сертифицируют ли специалистов, или же кадровый уровень средний/низкий.<br>Пример:<br> - Большинство менеджеров по продажам прошли обучение и имеют сертификаты, чего нет у конкурентов.<br>- У конкурентов сильная команда маркетинга, у клиента она только формируется.",
                "Принято": "Да",
                "Ответ РП": "",
                "Пример заполнения(Abrau-Durso)": "В компании работают квалифицированные виноделы и технологи, уровень выше среднего по отрасли.<br>При этом высокая доля сезонного персоанла средней и низкой квалификации, это характерно для всех с\\х предприятий.<br>Производство премиальных вин и получение наград требуют экспертизы. Это значит, что в компании работают специалисты высокой квалификации."
            },
            {
                "Код": "20.07",
                "Вопрос": "Финансовые ресурсы",
                "Комментарий к вопросу": "Достаточно ли собственных средств для ведения бизнеса?<br>Требуется получать кредиты, займы?<br>Есть ли у компании достаточно средств для развития или часто берут кредиты? Привлекает ли компания банковское финансирование или финансирование путем выпуска облигаций?",
                "Пояснение к вопросу": "Пример: - Развиваемся на собственные средства.<br>- Привлекаем банковское финансирование для расширения.<br>- Можно проанализировать эмиссию облигаций и открытую отчетность.",
                "Принято": "Да",
                "Ответ РП": "",
                "Пример заполнения(Abrau-Durso)": "У компании Abrau-Durso в настоящий момент есть стабильный рост выручки, прибыль, собственный капитал — ресурсов достаточно для развития, особенно за счёт реинвестирования. Однако существуют обязательства — долги и обязательства по облигациям, которые увеличивают финансовые риски.<br>По доступным данным выручка компании за 2024 выросла примерно на 43% по сравнению с 2023, чистая прибыль тоже растёт.<br>Также на сайте Cbonds есть выпущенные облигации у Abrau-Durso: облигационный выпуск «002P-01» («Абрау₂P-01») на сумму~500 млн рублей.<br>Всё это говорит, что компания может привлекать долговое финансирование и использует его, значит ресурсы не ограничены только собственными средствами."
            },
            {
                "Код": "20.08",
                "Вопрос": "Скорость реакции на изменения рынка",
                "Комментарий к вопросу": "Насколько быстро Заказчик сможет изменить процессы, продукты в случае измненения запроса рынка? Появились ли новые продукты/ услуги за последний год?",
                "Пояснение к вопросу": "Совершенствовались ли процессы производства?<br>Появились ли новые каналы сбыта? Стали ли работать в регионах, в которых раньше не работали?<br>Насколько быстро компания может адаптироваться к новым условиям: выпускать новые продукты, менять бизнес-процессы, открывать новые каналы продаж или выходить на новые регионы?<br>Пример:<br> - За последний год добавили продажи через Ozon.<br>- Изменения внедряются медленно: от идеи до запуска продукта проходит больше года.",
                "Принято": "Да",
                "Ответ РП": "",
                "Пример заполнения(Abrau-Durso)": "Компания быстро адаптируется: развивает e-commerce, запускает новые линейки, открывает бутики.<br>Реакция на изменения заметна: в последние годы они вышли в онлайн-каналы и усилили экспорт. Это признаки высокой гибкости."
            },
            {
                "Код": "20.09",
                "Вопрос": "Маркетинговые возможности",
                "Комментарий к вопросу": "Тратит Заказчик на маркетинг больше или меньше ключевых конкурентов? Есть у Заказчика маркетинговые возможности, которых у конкурентов нет?",
                "Пояснение к вопросу": "Тратит ли клиент больше или меньше конкурентов на маркетинг?<br>Есть ли у него каналы или возможности, которых нет у других?<br>Пример:<br> - Бюджет на рекламу выше среднего по рынку.<br>- Есть эксклюзивное партнёрство с отраслевым медиа.",
                "Принято": "Да",
                "Ответ РП": "",
                "Пример заполнения(Abrau-Durso)": "Использует сильные PR-поводы(награды, история бренда), собственные каналы и туризм.<br>Эти ресурсы дают конкурентное преимущество — не все производители имеют туристическую инфраструктуру и сильный бренд."
            },
            {
                "Код": "30.00",
                "Вопрос": "Привлекательность рынка",
                "Комментарий к вопросу": "",
                "Пояснение к вопросу": "",
                "Принято": "",
                "Ответ РП": "",
                "Пример заполнения(Abrau-Durso)": ""
            },
            {
                "Код": "31.00",
                "Вопрос": "Рыночные факторы",
                "Комментарий к вопросу": "К рыночным факторам привлекательности сегмента относятся: текущий размер сегмента или емкость рынка; уровень развития сегмента и его потенциальная емкость в натуральном и стоимостном выражении; темп роста сегмента за последние 3 года; возможность дальнейшего расширения ассортимента бренда при входе в сегмент; количество игроков в сегменте и динамика их продаж; наличие рекламной поддержки в сегменте.",
                "Пояснение к вопросу": "",
                "Принято": "",
                "Ответ РП": "",
                "Пример заполнения(Abrau-Durso)": ""
            },
            {
                "Код": "31.01",
                "Вопрос": "Размер сегмента большой 1-4 место на всем рынка",
                "Комментарий к вопросу": "Насколько велик рынок/сегмент, в котором работает клиент?",
                "Пояснение к вопросу": "Какое место занимает клиент среди конкурентов?<br>Пример:<br> - Компания занимает 3-е место по продажам в своём сегменте.<br>- Сегмент крупный, клиент пока в числе средних игроков.",
                "Принято": "Да",
                "Ответ РП": "",
                "Пример заполнения(Abrau-Durso)": "Да, рынок вина в России значителен, Abrau-Durso входит в число лидеров сегмента игристых.<br>Большая потребительская база и лидерство компании подтверждают значимость сегмента."
            },
            {
                "Код": "31.02",
                "Вопрос": "Темпы роста сегмента превышают темп роста",
                "Комментарий к вопросу": "Темпы роста сегмента превышают темп роста",
                "Пояснение к вопросу": "Растёт ли рынок клиента быстрее, чем рынок в целом? Нужно сравнить: растёт ли рынок, на котором работает клиент, быстрее или медленнее, чем другие рынки или отрасль в целом. Если быстрее — сегмент считается более привлекательным.<br>Пример:<br> - Рынок онлайн-образования растёт на 18% в год, тогда как общий рынок образовательных услуг — только на 6%.<br>- Сегмент продажи мебели растёт на 4% в год, что ниже среднего роста отрасли(7%).",
                "Принято": "Да",
                "Ответ РП": "",
                "Пример заполнения(Abrau-Durso)": "Подсегменты(онлайн-продажи, премиум) растут быстрее, чем рынок в целом.<br>Это показывает, что определённые ниши развиваются особенно активно и компания может на них заработать."
            },
            {
                "Код": "31.03",
                "Вопрос": "В сегменте присутствует ограниченное количество игроков без инвестиций в рекламу",
                "Комментарий к вопросу": "В сегменте присутствует ограниченное количество игроков без инвестиций в рекламу",
                "Пояснение к вопросу": "Есть ли на рынке конкуренты, которые мало вкладываются в рекламу? Это создаёт возможность выделиться при правильных инвестициях в продвижение.<br>Пример:<br> - В сегменте всего 4 крупных игрока, реклама слабая.<br>- Большинство конкурентов не используют digital-каналы.",
                "Принято": "Да",
                "Ответ РП": "",
                "Пример заполнения(Abrau-Durso)": "На рынке есть якорные производители и много мелких виноделов без крупных рекламных бюджетов — это даёт ниши.<br>Это создаёт для Abrau-Durso возможность выделяться активными маркетинговыми кампаниями."
            },
            {
                "Код": "31.04",
                "Вопрос": "При успешном входе в сегмент возможно дальнейшие расширение ассортимент",
                "Комментарий к вопросу": "При успешном входе в сегмент возможно дальнейшие расширение ассортимент",
                "Пояснение к вопросу": "Если клиент успешно закрепится на рынке, сможет ли он расширить линейку продуктов/услуг?<br>Пример:<br> - При выходе на рынок онлайн-образования можно добавить новые курсы.<br>- В сегменте бытовой техники возможно расширение ассортимента за счёт мелкой электроники.",
                "Принято": "Да",
                "Ответ РП": "",
                "Пример заполнения(Abrau-Durso)": "Компания может расширять линейки(сидр, безалкогольное, новые форматы).<br>У Abrau-Durso уже есть примеры выхода за рамки классического игристого вина, значит потенциал есть."
            },
            {
                "Код": "32.00",
                "Вопрос": "Потребительские факторы",
                "Комментарий к вопросу": "Потребительские факторы — являются наиболее важными факторами модели Mckinsey, так как оценивают наличие свободных рыночных ниш(анализируя существование неудовлетворенных потребностей покупателей).",
                "Пояснение к вопросу": "",
                "Принято": "",
                "Ответ РП": "",
                "Пример заполнения(Abrau-Durso)": ""
            },
            {
                "Код": "32.01",
                "Вопрос": "Размер потребительской базы сегмента большой 1-4 место на всем рынка",
                "Комментарий к вопросу": "Насколько много потенциальных покупателей у клиента?",
                "Пояснение к вопросу": "Занимает ли клиент заметную долю рынка?<br>Пример:<br> - Клиент обслуживает 2 млн пользователей, 3-е место на рынке.<br>- База средняя, около 20 тыс. постоянных клиентов.",
                "Принято": "Да",
                "Ответ РП": "",
                "Пример заполнения(Abrau-Durso)": "Да, у рынка вина в России очень широкая аудитория — миллионы покупателей по всей стране. Abrau-Durso входит в число крупнейших игроков и обслуживает значительную долю этого спроса.<br>Вина(и особенно игристые) покупают во многих регионах и разными категориями клиентов — от массовых покупателей в супермаркетах до корпоративных заказчиков. Это подтверждает, что база потребителей у сегмента действительно очень большая, а компания работает не с нишевой, а с массовой аудиторией."
            },
            {
                "Код": "32.02",
                "Вопрос": "Низкий уровень культуры потребления продукта — высокий потенциал роста рынка",
                "Комментарий к вопросу": "Низкий уровень культуры потребления продукта — высокий потенциал роста рынка",
                "Пояснение к вопросу": "Знакомы ли покупатели с продуктом? То есть здесь важно оценить, насколько хорошо аудитория понимает и ценит продукт, и есть ли потенциал роста, если потребители пока плохо знакомы с продуктом.<br>Пример:<br> - Онлайн-страхование пока не популярно, но интерес быстро растёт.<br>- Культура потребления развита слабо, клиенты только начинают пробовать.",
                "Принято": "Да",
                "Ответ РП": "",
                "Пример заполнения(Abrau-Durso)": "Да, культура потребления вина в России ещё формируется: многие покупатели ориентируются на цену, а не на качество. Это даёт потенциал для роста — через развитие премиальных линеек и просвещение потребителей.<br>В России по сравнению с традиционными винными странами(Франция, Италия) культура потребления вина менее развита. Люди часто выбирают «дешевле», а не «качественнее». Abrau-Durso может использовать это как возможность: обучать потребителей, предлагать дегустации, развивать премиум-бренды и постепенно повышать культуру потребления."
            },
            {
                "Код": "32.03",
                "Вопрос": "Уровень знания конкурирующих брендов среди аудитории не высок, уровень лояльности низкий",
                "Комментарий к вопросу": "Уровень знания конкурирующих брендов среди аудитории не высок, уровень лояльности низкий",
                "Пояснение к вопросу": "Насколько хорошо клиенты знают конкурентов? Привязаны ли они к брендам или легко переходят между ними?<br>Пример:<br> - Большинство покупателей не различает бренды и выбирает по цене.<br>- Лояльность низкая: клиенты быстро меняют поставщика при скидках.",
                "Принято": "Да",
                "Ответ РП": "",
                "Пример заполнения(Abrau-Durso)": "В массовом сегменте вина покупатели редко различают бренды — они выбирают по цене или наличию в магазине. Поэтому лояльность низкая: потребитель легко меняет марку.<br>На российском рынке вина у среднего покупателя нет глубокого знания брендов(например, многие не отличают Abrau-Durso от других крупных производителей). Лояльность формируется только у части аудитории — в премиальном сегменте или у туристов, знакомых с брендом. Это значит, что у компании есть потенциал усилить узнаваемость и удержание через маркетинг и программы лояльности."
            },
            {
                "Код": "32.04",
                "Вопрос": "Часть текущих потребностей потребителя в товаре не удовлетворена, существуют скрытые и неудовлетворенные потребности",
                "Комментарий к вопросу": "Часть текущих потребностей потребителя в товаре не удовлетворена, существуют скрытые и неудовлетворенные потребности",
                "Пояснение к вопросу": "Есть ли у клиентов запросы, которые конкуренты не закрывают?<br>Что ещё хотят клиенты, но пока не получают?<br>Пример:<br> - Клиенты хотят доставку за 1 день, но пока только за 3.<br>- Нет удобного мобильного приложения, хотя пользователи его ждут.",
                "Принято": "Да",
                "Ответ РП": "",
                "Пример заполнения(Abrau-Durso)": "Клиенты хотят больше премиальных российских вин и удобных способов доставки.<br>В этих нишах у компании есть шанс развиваться."
            },
            {
                "Код": "33.00",
                "Вопрос": "Тенденции рынка",
                "Комментарий к вопросу": "",
                "Пояснение к вопросу": "",
                "Принято": "",
                "Ответ РП": "",
                "Пример заполнения(Abrau-Durso)": ""
            },
            {
                "Код": "33.01",
                "Вопрос": "Прогнозируется долгосрочный рост сегмента В особенности, когда сегмент является самым быстрорастущим из оцениваемых альтернатив",
                "Комментарий к вопросу": "Ожидается ли, что рынок клиента будет расти в ближайшие годы? Насколько этот рост устойчивый и привлекательный?",
                "Пояснение к вопросу": "Пример: - Прогноз роста e-commerce на 15% ежегодно в течение 5 лет.<br>- Сегмент стабилен, но рост незначительный(2–3% в год).",
                "Принято": "Да",
                "Ответ РП": "",
                "Пример заполнения(Abrau-Durso)": "Да, рынок вина будет расти, особенно онлайн и премиум.<br>Прогнозы отрасли указывают на положительный рост."
            },
            {
                "Код": "33.02",
                "Вопрос": "Существующие потребительские тренды благоприятны для входа на рынок",
                "Комментарий к вопросу": "Существующие потребительские тренды благоприятны для входа на рынок",
                "Пояснение к вопросу": "Есть ли тенденции в поведении покупателей, которые делают рынок более привлекательным?<br>Пример:<br> - Растёт спрос на онлайн-обучение и дистанционные сервисы.<br>- Тренд на экотовары поддерживает интерес к продукции клиента.",
                "Принято": "Да",
                "Ответ РП": "",
                "Пример заполнения(Abrau-Durso)": "Да, тренды на локальные и премиальные вина создают хорошие условия.<br>Это соответствует позиционированию Abrau-Durso."
            },
            {
                "Код": "33.03",
                "Вопрос": "Минимальны риски влияния макросреды на снижение емкости рынка",
                "Комментарий к вопросу": "Риски: экономический кризис, смена власти, изменение климата, ужесточение климатических условий, снижение уровня жизни населения, уменьшение целевой аудитории из-за демографического спада и т.д",
                "Пояснение к вопросу": "Есть ли внешние факторы(кризис, политика, демография, экология), которые могут снизить спрос? Если риски малы — рынок более безопасен.<br>Пример:<br> - Рынок не зависит от импортных поставок, макрориски низкие.<br>- Высокая зависимость от курса валют повышает риск.",
                "Принято": "Да",
                "Ответ РП": "",
                "Пример заполнения(Abrau-Durso)": "Есть риски: урожай(погодные условия), регуляторика/акцизы, экономические колебания — но в целом риски управляемы.<br>Климат и регуляторика — типичные отраслевые риски; предприятия их учитывают в планах."
            },
            {
                "Код": "40.00",
                "Вопрос": "Цепочка создания ценности",
                "Комментарий к вопросу": "",
                "Пояснение к вопросу": "",
                "Принято": "",
                "Ответ РП": "",
                "Пример заполнения(Abrau-Durso)": ""
            },
            {
                "Код": "40.01",
                "Вопрос": "Ведущая стратегия производства",
                "Комментарий к вопросу": "Указывается для производственных предприятий.<br>Возможные стратегии - Под заказ. Производство продукции ведется преимущественно под заказы покупателей.<br>- На склад. Производство преимущественно ведется, исходя из прогнозов спроса на продукцию.<br>- Смешанная. Используются оба способа примерно в равном объеме.",
                "Пояснение к вопросу": "Как устроено производство: под заказ, на склад или смешанный вариант?<br>Пример:<br> - Производим мебель под заказ.<br>- Часть продукции держим на складе для быстрого сбыта.",
                "Принято": "Да",
                "Ответ РП": "",
                "Пример заполнения(Abrau-Durso)": "Смешанная: массовое производство для широкой дистрибуции+ отдельные партии под премиум/резерв.<br>Компания одновременно выпускает большие объёмы и коллекционные серии."
            },
            {
                "Код": "40.02",
                "Вопрос": "Ведущее ограничение для роста бизнеса",
                "Комментарий к вопросу": "Возможные варианты: - План продаж. Предприятие не испытывает сложности с производством и закупкой материалов для производства.<br>Условно может произвести сколько надо продукции, ограничивает спрос на продукцию.<br>- План производства. Предприятие не испытвает сложности со сбытом продукции и закупкой материалов для производства. Ограничением являются производственные мощности - План закупок. Производство и сбыт можно увеличивать, есть сложности с закупкой материалов для производства.",
                "Пояснение к вопросу": "Что сдерживает рост: недостаток продаж, мощности производства или сложности с закупками?<br>Пример:<br> - Ограничение — производственные мощности.<br>- Спрос выше, чем можем обеспечить.",
                "Принято": "Да",
                "Ответ РП": "",
                "Пример заполнения(Abrau-Durso)": "Основные ограничения: доступ к экспортным каналам и логистика, а также необходимость инвестиций в новые рынки/каналы; в зависимости от периода — ограничением может быть и мощность розлива/склад.<br>Компания фокусируется на увеличении экспорта и розничной сети — эти направления требуют инвестиций и логистики."
            },
            {
                "Код": "40.03",
                "Вопрос": "Входящая логистика",
                "Комментарий к вопросу": "Это включает складирование, прием и управление запасами сырья и других компонентов.",
                "Пояснение к вопросу": "Как клиент получает и хранит сырьё и материалы?<br>Пример:<br> - Склад в Подмосковье, регулярные поставки от 3-х поставщиков.",
                "Принято": "Да",
                "Ответ РП": "",
                "Пример заполнения(Abrau-Durso)": "Собственные и контрактные поставки винограда (Краснодарский край), владение площадками и складскими мощностями; гибкая логистика по РФ.<br>В группе есть собственные виноградники и логистические центры по регионам."
            },
            {
                "Код": "40.04",
                "Вопрос": "Операции",
                "Комментарий к вопросу": "Сюда относятся процессы превращения сырья в готовый продукт.",
                "Пояснение к вопросу": "Как организован процесс превращения сырья в готовый продукт?<br>Пример:<br> - Автоматизированная линия сборки.",
                "Принято": "Да",
                "Ответ РП": "",
                "Пример заполнения(Abrau-Durso)": "Производство использует классический метод и Charmat, современное оборудование, выдержку в туннелях — стандартизованные процессы для разных линеек.<br>Компания указывает на использовании классического и Charmat методов, что подтверждает операционные процессы.  Эти методы описаны как базовые у производителя."
            },
            {
                "Код": "40.05",
                "Вопрос": "Исходящая логистика",
                "Комментарий к вопросу": "Это включает процессы сортировки, упаковки и доставки.",
                "Пояснение к вопросу": "Как клиент доставляет продукцию покупателям?<br>Пример:<br> - Доставка собственным автопарком.<br>- Отгрузка через транспортные компании.",
                "Принято": "Да",
                "Ответ РП": "",
                "Пример заполнения(Abrau-Durso)": "Отгрузка через ритейл, дистрибьюторов, собственные бутики, экспорт.<br>Присутствует региональная дистрибуция, собственные точки и экспортные отгрузки."
            },
            {
                "Код": "40.06",
                "Вопрос": "Маркетинг и продажи",
                "Комментарий к вопросу": "Сюда относятся стратегия ценообразования, продвижение и реклама.",
                "Пояснение к вопросу": "Чем больше всего гордится клиент",
                "Принято": "Да",
                "Ответ РП": "",
                "Пример заполнения(Abrau-Durso)": "Гордится историей бренда, международными наградами, широкой дистрибуцией и развитием собственных бренд-точек/туристической составляющей.<br>Компания активно использует свою историю и награды в коммуникации и открывает бренд-бутики."
            },
            {
                "Код": "40.07",
                "Вопрос": "Послепродажные процессы",
                "Комментарий к вопросу": "Это включает обучение, установку, ремонт, обслуживание клиентов и контроль качества.",
                "Пояснение к вопросу": "Как клиент работает с клиентами после продажи: сервис, обучение, поддержка?<br>Пример:<br> - Горячая линия поддержки 24/7.<br>- Бесплатное обучение пользователей.",
                "Принято": "Да",
                "Ответ РП": "",
                "Пример заполнения(Abrau-Durso)": "Туристические мероприятия, дегустации, бренд-события.<br>Винная индустрия опи рается на мероприятия, дегустации и работу с корпоративными/HoReCa каналами; Abrau-Durso развивает такие активности."
            }
        ];

        const API_URL = 'https://api.proxyapi.ru/openai/v1/chat/completions';
        const MODEL = 'gpt-4o-search-preview';

        // Функция для отображения таблицы
        function renderTable() {
            const tbody = document.querySelector('#questionsTable tbody');
            tbody.innerHTML = '';

            questionsData.forEach((item, index) => {
                const row = document.createElement('tr');

                // Проверяем, является ли строка разделителем
                const isSectionHeader = item['Код'].endsWith('.00');

                if (isSectionHeader) {
                    row.classList.add('section-header');
                }

                let answerCellContent = '';
                let answerCellClass = '';

                if (isSectionHeader) {
                    // Для строк-заголовков: пустая ячейка с оранжевым фоном
                    answerCellContent = '';
                    // Мы полагаемся на стиль .section-header .answer-col
                } else {
                    // Для обычных строк: текстовое поле
                    answerCellContent = `<textarea id="answer-${index}">${item['Ответ РП'] || ''}</textarea>`;
                }
                row.innerHTML = `
                    <td>${item['Код']}</td>
                    <td>${item['Вопрос']}</td>
                    <td>${item['Комментарий к вопросу']}</td>
                    <td>${item['Пояснение к вопросу']}</td>
                    <td class="answer-col">
                        ${answerCellContent}
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Функция для показа статусного сообщения
        function showStatus(message, isError = false) {
            const statusDiv = document.getElementById('statusMessage');
            statusDiv.textContent = message;
            statusDiv.className = 'status';
            if (isError) {
                statusDiv.classList.add('error');
            } else {
                statusDiv.classList.add('success');
            }
            statusDiv.style.display = 'block';

            // Автоматически скрываем сообщение через 5 секунд
            setTimeout(() => {
                statusDiv.style.display = 'none';
            }, 5000);
        }

        // Функция для получения ответов от ИИ
        async function fetchAIAnswers() {
            const apiKey = document.getElementById('apiKey').value.trim();
            const companyName = document.getElementById('companyName').value.trim();

            if (!apiKey) {
                showStatus('Пожалуйста, введите API-ключ.', true);
                return;
            }
            if (!companyName) {
                showStatus('Пожалуйста, введите название компании.', true);
                return;
            }

            const fillBtn = document.getElementById('fillBtn');
            fillBtn.disabled = true;
            fillBtn.textContent = 'Заполнение...';

            try {
                // Фильтруем вопросы (исключаем заголовки)
                const questionsToProcess = questionsData.filter(q => !q['Код'].endsWith('.00'));

                // Разбиваем вопросы на блоки по 10
                const questionBlocks = [];
                for (let i = 0; i < questionsToProcess.length; i += 10) {
                    questionBlocks.push(questionsToProcess.slice(i, i + 10));
                }

                // Обрабатываем каждый блок
                for (const block of questionBlocks) {
                    // Формируем промт для ИИ для текущего блока
                    let prompt = `Вы являетесь экспертом по бизнес-анализу. Проанализируйте компанию "${companyName}" и ответьте на следующие вопросы. Отвечайте кратко и по существу, используя деловой стиль. Каждый ответ должен начинаться с кода вопроса (например, "10.01."). Формат ответа: "Код. Ответ". \n\n`;

                    block.forEach((q) => {
                        prompt += `Вопрос ${q['Код']}: ${q['Вопрос']}\n`;
                        if (q['Комментарий к вопросу']) {
                            // Заменяем <br> на \n в данных перед добавлением в промт
                            prompt += `Комментарий: ${q['Комментарий к вопросу'].replace(/<br>/g, '\n')}\n`;
                        }
                        if (q['Пояснение к вопросу']) {
                            // Заменяем <br> на \n в данных перед добавлением в промт
                            prompt += `Пояснение: ${q['Пояснение к вопросу'].replace(/<br>/g, '\n')}\n`;
                        }
                        if (q['Пример заполнения(Abrau-Durso)']) {
                            // Заменяем <br> на \n в данных перед добавлением в промт
                            prompt += `Пример для Abrau-Durso: ${q['Пример заполнения(Abrau-Durso)'].replace(/<br>/g, '\n')}\n`;
                        }
                        prompt += '\n---\n';
                    });

                    // Убираем возможные множественные пустые строки
                    prompt = prompt.replace(/\n{3,}/g, '\n\n');

                    console.log("Отправляемый промт:", prompt); // Для отладки
                    // Отображаем отправленный промт в отладочном поле
                    document.getElementById('sentPrompt').value = prompt;

                    // Отправляем запрос к API
                    const response = await fetch(API_URL, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${apiKey}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            model: MODEL,
                            messages: [{ role: 'user', content: prompt }]
                            // Убраны параметры temperature и max_tokens, вызывающие ошибку
                        })
                    });

                    if (!response.ok) {
                        let errorMessage = `HTTP error! status: ${response.status}`;
                        try {
                            const errorData = await response.json();
                            errorMessage = errorData.error?.message || errorMessage;
                        } catch (e) {
                            // Игнорируем ошибку парсинга JSON
                        }
                        throw new Error(errorMessage);
                    }

                    const data = await response.json();
                    const aiResponse = data.choices[0].message.content;

                    console.log("Ответ от ИИ:", aiResponse); // Для отладки

                    // Отображаем сырой ответ в отладочном поле (обновляем постепенно)
                    const rawResponseArea = document.getElementById('rawResponse');
                    rawResponseArea.value += `\n--- БЛОК ---\n${aiResponse}\n`;

                    // Парсим ответ ИИ и заполняем поля
                    parseAIResponse(aiResponse);
                }

                showStatus('Ответы успешно получены от ИИ.');

            } catch (error) {
                console.error('Ошибка при запросе к ИИ:', error);
                showStatus(`Ошибка: ${error.message}`, true);
            } finally {
                fillBtn.disabled = false;
                fillBtn.textContent = 'Заполнить';
            }
        }

        // Функция для парсинга ответа ИИ
        function parseAIResponse(responseText) {
            // Если ИИ вернул сообщение о том, что информация ограничена, заполняем все ответы этим сообщением
            if (responseText.includes("К сожалению, доступная информация о компании") &&
                responseText.includes("ограничена") &&
                responseText.includes("невозможно предоставить точные ответы")) {

                questionsData.forEach((item) => {
                    // Пропускаем разделители
                    if (!item['Код'].endsWith('.00')) {
                        const index = questionsData.indexOf(item);
                        item['Ответ РП'] = "Информация о компании ограничена. Невозможно предоставить точный ответ.";
                        const textarea = document.getElementById(`answer-${index}`);
                        if (textarea) {
                            textarea.value = item['Ответ РП'];
                        }
                    }
                });
                return;
            }

            // Разбиваем ответ на строки по символу новой строки
            const lines = responseText.split('\n');

            let currentCode = null;
            let currentAnswerLines = [];

            lines.forEach(line => {
                // Убираем начальные и конечные пробелы
                const trimmedLine = line.trim();
                if (!trimmedLine) return; // Пропускаем пустые строки

                // Проверяем, начинается ли строка с кода вопроса
                // Учитываем возможные символы форматирования вокруг кода, например:
                // "10.01. ", "**10.01.** ", "10.01 ", "**10.01** "
                // Регулярное выражение ищет код в начале строки с возможными ** до и после
                const codeMatch = trimmedLine.match(/^(\*\*)?(\d+\.\d+)\.?(\*\*)?\s*/);

                if (codeMatch) {
                    // Если уже есть предыдущий ответ, сохраняем его
                    if (currentCode && currentAnswerLines.length > 0) {
                        const fullAnswer = processAnswer(currentAnswerLines.join('\n'));
                        updateAnswer(currentCode, fullAnswer);
                    }

                    // Начинаем новый ответ
                    // codeMatch[2] содержит сам код (например, "10.01")
                    currentCode = codeMatch[2];
                    // Берем остаток строки после кода
                    const restOfLine = trimmedLine.substring(codeMatch[0].length).trim();
                    currentAnswerLines = restOfLine ? [restOfLine] : [];
                } else if (currentCode) {
                    // Продолжаем формировать ответ, если код уже найден
                    currentAnswerLines.push(trimmedLine);
                }
                // Если код не найден и currentCode еще не установлен, строка игнорируется
                // Это позволяет пропустить вводный текст до первого кода
            });

            // Сохраняем последний ответ
            if (currentCode && currentAnswerLines.length > 0) {
                const fullAnswer = processAnswer(currentAnswerLines.join('\n'));
                updateAnswer(currentCode, fullAnswer);
            }
        }

        // Функция для обновления ответа в таблице
        function updateAnswer(code, answer) {
            const question = questionsData.find(q => q['Код'] === code);
            if (question) {
                question['Ответ РП'] = answer;
                const index = questionsData.indexOf(question);
                const textarea = document.getElementById(`answer-${index}`);
                if (textarea) {
                    textarea.value = answer;
                }
                console.log(`Обновлен ответ для ${code}: ${answer}`); // Для отладки
            } else {
                console.log(`Вопрос с кодом ${code} не найден`); // Для отладки
            }
        }

        // Функция для постобработки ответа (удаление "Определилось только:" и перенос источников в конец)
        function processAnswer(answer) {
            // удаляем все ** и лишние пробелы в начале и конце
            let processedAnswer = answer.replace(/\*\*/g, '').trim();

            // Удаляем "Определилось только:" и текст до него, если он есть
            const onlyDeterminedIndex = processedAnswer.indexOf("Определилось только:");
            if (onlyDeterminedIndex !== -1) {
                processedAnswer = processedAnswer.substring(onlyDeterminedIndex + "Определилось только:".length).trim();
            }

            // Массив для хранения найденных источников
            const sources = [];

            const cleanedAnswer = processedAnswer.replace(/\((?:\[([^\]]+)\]\((https?:\/\/[^\s)]+)\)|(https?:\/\/[^\s)]+))\)/g, (_, _label, url1, url2) => {
                sources.push(url1 || url2);
                return '';
            });

            const  clearedOfUtm = sources.map(src => {
                const url = new URL(src);
                url.searchParams.delete("utm_source");

                return url.toString();
            });

            // Формируем финальный ответ
            let finalAnswer = cleanedAnswer;

            // Если есть источники, добавляем их в конце
            if (clearedOfUtm.length > 0) {
                // Удаляем дубликаты источников
                const uniqueSources = [...new Set(clearedOfUtm)];
                finalAnswer += "\n\nИсточники:\n" + uniqueSources.join("\n");
            }

            return finalAnswer;
        }

        // Функция для сохранения таблицы в CSV
        function saveToCSV() {
            let csvContent = '\uFEFF'; // BOM для корректного отображения кириллицы в Excel
            csvContent += '"Код";"Вопрос";"Комментарий к вопросу";"Пояснение к вопросу";"Ответ"\n';

            questionsData.forEach(item => {
                // Пропускаем разделители при экспорте
                if (!item['Код'].endsWith('.00')) {
                    const row = [
                        `"${item['Код']}"`,
                        `"${item['Вопрос'].replace(/"/g, '""')}"`,
                        `"${item['Комментарий к вопросу'].replace(/"/g, '""')}"`,
                        `"${item['Пояснение к вопросу'].replace(/"/g, '""')}"`,
                        `"${(item['Ответ РП'] || '').replace(/"/g, '""')}"`
                    ].join(';');
                    csvContent += row + '<br>';
                }
            });

            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.setAttribute('href', url);
            link.setAttribute('download', `анализ_бизнеса_${new Date().toISOString().slice(0, 10)}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);

            showStatus('Файл CSV успешно сохранен.');
        }

        // Инициализация
        document.addEventListener('DOMContentLoaded', () => {
            renderTable();
            document.getElementById('fillBtn').addEventListener('click', fetchAIAnswers);
            document.getElementById('saveBtn').addEventListener('click', saveToCSV);
        });
    </script>
</body>

</html>
